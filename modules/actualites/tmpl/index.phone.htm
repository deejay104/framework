<!-- BEGIN: icone -->
	<img src="{path_module}/img/icn48_titre.png" alt="" border=0 />
<!-- END: icone -->

<!-- BEGIN: infos -->
<!-- END: infos -->


<!-- BEGIN: corps -->

<div class="cadreinfos">

	<div class="encadreInfos">
		<div class="encadreTitre">Informations Personnelles</div>
	  
			<!-- BEGIN: lst_echeance -->
			<p>{form_echeance}</p>
			<!-- END: lst_echeance -->
	</div>	

<p style="text-align:center;"><a href="index.php?settheme=default">-Revenir à l'affichage classique-</a></p>

	<div class="encadreInfos">
		<a name="poster"></a>
		<div class="encadreTitre">Poster un nouveau message</div>
		<div id="actualitesNouveau" class="actualitesNouveau">		
			<form name="actualites" method="post" action="index.php#poster" enctype="multipart/form-data">
				<input type="hidden" name="mod" value="actualites">
				<input type="hidden" name="id" value="{form_id}">
				<input type="hidden" name="checktime" value="{form_checktime}">
		
				<input type="text" name="form_titre" value="{news_title}" OnFocus="ClearText(event,'{news_title_clear}');"  style="color:#bbbbbb;"><br />
				<textarea name="form_message" OnFocus="ClearText(event,'{news_message_clear}');" style="color:#bbbbbb;">{news_message}</textarea>
				<p>
					<input name='fonc' type='submit' value='Poster'>
				</p>
			</form>
		</div>
	</div>

</div>

<!-- BEGIN: aff_message1 -->
<div id="actualites" class="actualites">

<!-- BEGIN: aff_message2 -->
	<div class="actualitesMessage">
		<div class="actualitesTitre">
			<div class="actualitesPhoto">
				<img src="{msg_avatar}" alt="">
			</div>
			<div class="actualitesTitreMsg">
				<a name="id{msg_id}"></a>
				<p>{msg_titre}</p>
				<span>par {msg_autheur}, {msg_date}</span>
			</div>
		</div>
		<div class="actualitesTexte">
			<p>{msg_message}</p>
		</div>
	</div>
<!-- END: aff_message2 -->

	<div class="actualitesSuivant">
		<a href="index.php?mod=actualites&limit={aff_limit}&search={aff_search}#id{msg_lastid}">-Afficher les actualités suivantes-</a>
	</div>

	<br />
	<br />


</div>
<!-- END: aff_message1 -->

	<div id="news" class="actualites">
	</div>

<script type="text/javascript">
	var lastid=0;
	var aff=0;
	var searchTxt="";

	$(function() {

			// auto adjust the height of
			$('#actualitesNouveau').delegate( 'textarea', 'keydown', function (){
			    $(this).height( 0 );
			    $(this).height( this.scrollHeight );
			});
			$('#actualitesNouveau').find( 'textarea' ).keydown();
	});

	function loadNews(id,limit,search) {
		console.log("load:"+id+"-"+limit+" (lastid:"+lastid+")");

		$.ajax({
			type: 'GET',
			url: 'api.php?mod=actualites&rub=actualites&fonc=get&id='+id+'&limit='+limit+'&search='+search,
			dataType: 'JSON',

			success: function(response) {

				var txt="";
				if (response.news.length>0)
				{
					$.each(response.news, function (index, value)
					{

						txt="<div id='news_"+value.id+"' class='actualitesMessage'>";
						txt=txt+"	<div class='actualitesTitre'>";
						txt=txt+"		<div class='actualitesPhoto'>";
						txt=txt+"			<img src='"+value.avatar+"' alt=''>";
						txt=txt+"		</div>";
						txt=txt+"		<div class='actualitesTitreMsg'>";
						txt=txt+"			<p>"+value.title+"</p>";
						txt=txt+"			<span>par "+value.author+", "+value.date+"</span>";
						txt=txt+"		</div>";
						txt=txt+"	</div>";
						txt=txt+"	<div class='actualitesTexte'>";
						txt=txt+"		<p>"+value.message+"</p>";
						txt=txt+"	</div>";
						txt=txt+"</div>";

						$("#news").append(txt);
						lastid=value.id;
						console.log("lastid:"+lastid);
					});
				}
				aff=0;
			},
			error: function(response) {
				console.log("error");
				console.log(response);
			}
		});
	}

	function delNews(id)
	{
		var is_confirmed = confirm("Souhaitez-vous supprimer cette actualité ?");
		if (is_confirmed) { 
			
			$.ajax({
				type: 'GET',
				url: 'api.php?mod=actualites&rub=actualites&fonc=del&id='+id,
				dataType: 'JSON',

				success: function(response) {
					document.getElementById('news_'+id).style.display='none';
				}
			});
		}
		return false;
	}
	
	loadNews(0,2,"");
		
	$(window).scroll(function() {
		if ($(window).scrollTop() + $(window).height() >= $(document).height()-120)
		{
console.log("scroll:"+$(window).scrollTop()+"+"+$(window).height()+" > "+$(document).height());
			if (aff==0)
			{
				aff=1;
				loadNews(lastid,1,'');
			}
		}
	});
	
	function ClearText(e,txt) {
	
		if(window.event)
	          {
	          	//IE
	          	var t = window.event.srcElement;
	          } 
		else
	          { //firefox
	          	var t = e.target;
	          } 
			
		if (t.value==txt)
		  { t.value=''; t.style.color="#000000"; }
		return;
	}

</script>

<!-- BEGIN: aff_sendmail -->
<script type="text/javascript">
	document.getElementById("actualitesMail").innerHTML = "Envoie des emails...";
	document.getElementById("actualitesMail").style.display = 'block';
	$(function() {     
		$.ajax({
			url:'api.php?mod=actualites&rub=sendmail&id={aff_id}',
			type: 'html',
			success: function(content,code) {
				if (content.charAt(0)=="O")
				{
					document.getElementById("actualitesMail").style.backgroundColor = "#BBFFAA";
				}
				else
				{
					document.getElementById("actualitesMail").style.backgroundColor = "#FFBBAA";
				}

				document.getElementById("actualitesMail").innerHTML =content;

				if (content.charAt(0)!="*")
				{
					document.getElementById("actualitesMail").style.display = 'block';
				}
			}
			error: function(content,code) {
				document.getElementById("actualitesMail").style.backgroundColor = "#FFBBAA";
				document.getElementById("actualitesMail").innerHTML = "Impossible d'ouvrir la page d'envoie du mail";
				document.getElementById("actualitesMail").style.display = 'block';
			}
		});        
	});
</script>
<!-- END: aff_sendmail -->


<!-- END: corps -->

