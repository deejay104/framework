<!-- BEGIN: icone -->
	<img src="{path_module}/img/icn48_titre.png" alt="" border=0 />
<!-- END: icone -->
<!-- BEGIN: infos -->
	 {site_title}
<!-- END: infos -->


<!-- BEGIN: corps -->

<div class="cadreinfos">

	<div class="encadreInfos">
		<div class="encadreTitre">Informations</div>
  		<p style='padding-bottom: 5px;'><A href="{path_root}/docs">Nombre de documents non lus</A> : <A href="index.php?mod=docs" class="{color_nonlus}">{nb_nonlus}</A></p>
		<!-- BEGIN: lst_echeance -->
		<p>{form_echeance}</p>
		<!-- END: lst_echeance -->
	</div>

	<div class="encadreInfos">
		<div class="encadreTitre">Rechercher dans les actualités</div>
		<form name="recherche" method="post" action="{path_root}/index.php" enctype="multipart/form-data">
			<input type="hidden" name="mod" value="actualites">
			<p><input id="search" type="text" name="search" OnClick="ClearText(event,'Termes à rechercher');" value="Termes à rechercher" OnKeyUp="CapturePost(event);" style="color:#bbbbbb;"></p>
		</form>
	</div>
	{aff_custom}
</div>

<div id="actualites" class="actualites">
	<div id="actualitesNouveau" class="actualitesNouveau">
		<form name="actualites" method="post" action="{path_root}/index.php" enctype="multipart/form-data">
			<input type="hidden" name="mod" value="actualites">
			<input type="hidden" name="id" value="{form_id}">
			<input type="hidden" name="checktime" value="{form_checktime}">
	
			<input type="text" name="form_titre" value="{news_title}" OnFocus="ClearText(event,'{news_title_clear}');"  style="color:#{new_color};"><br />
			<textarea name="form_message" OnFocus="ClearText(event,'{news_message_clear}');"  style="color:#{new_color}; height:51px;">{news_message}</textarea>
			<p>
				<input name='fonc' type='submit' value='Poster'>
			</p>
		</form>
	</div>

	<div id="news">
	</div>


</div>


<script type="text/javascript">
	var lastid=0;
	var aff=0;
	var searchTxt="";

	$(function() {

			// auto adjust the height of
			$('#actualitesNouveau').delegate( 'textarea', 'keydown', function (){
			    $(this).height( 0 );
			    $(this).height( this.scrollHeight );
			});
			$('#actualitesNouveau').find( 'textarea' ).keydown();

	});

	function loadNews(id,limit,search) {
		console.log("load:"+id+"-"+limit);
		console.log("lastid:"+lastid);

		$.ajax({
			type: 'GET',
			url: '{apiurlget}&id='+id+'&limit='+limit+'&search='+search,
			dataType: 'JSON',

			success: function(response) {

				var txt="";
				if (response.news.length>0)
				{
					$.each(response.news, function (index, value) {

						txt="<div id='news_"+value.id+"' class='actualitesBloc'>";
						txt=txt+"	<div class='actualitesPhoto' >";
						txt=txt+"		<img src='{path_root}/"+value.avatar+"' alt=''>";
						txt=txt+"	</div>";
						txt=txt+"	<div class='actualitesMessage'>";
						txt=txt+"		<div class='actualitesTitre' OnMouseOver='document.getElementById(\"icone_"+value.id+"\").style.display=\"block\";' OnMouseOut='document.getElementById(\"icone_"+value.id+"\").style.display=\"none\";'>";
						txt=txt+"			<div class='actualitesTitreMsg'>";
						txt=txt+"				<a name='id"+value.id+"'></a>";
						txt=txt+"				<p>"+value.title+"</p>";
						txt=txt+"				<span>par "+value.author+", "+value.date+"</span>";
						txt=txt+"			</div>";
						txt=txt+"			<div id='icone_"+value.id+"' class='actualitesIcones' style='display:none;'>";
						txt=txt+"				<a href='index.php?mod=actualites&fonc=editer&id="+value.id+"' class='imgDelete'><img src='{path_root}/{path_module}/img/icn16_editer.png' /></a>";
						txt=txt+"				<a href='' class='imgDelete' OnClick='return delNews("+value.id+");'><img src='{path_root}/{path_module}/img/icn16_supprimer.png' /></a>";
						txt=txt+"			</div>";
						txt=txt+"		</div>";
						txt=txt+"		<div class='actualitesTexte'>";
						txt=txt+"<p>"+value.message+"</p>";
						txt=txt+"</div>";
						txt=txt+"	</div>";
						txt=txt+"</div>";
						$("#news").append(txt);
						lastid=value.id;
						console.log("lastid:"+lastid);
					});
				}
				aff=0;
			},
			error: function(response) {
				console.log("error");
				console.log(response);
			}
		});
	}

	function delNews(id)
	{
		var is_confirmed = confirm("Souhaitez-vous supprimer cette actualité ?");
		if (is_confirmed) { 
			
			$.ajax({
				type: 'GET',
				url: '{apiurldel}&id='+id,
				dataType: 'JSON',

				success: function(response) {
					document.getElementById('news_'+id).style.display='none';
				}
			});
		}
		return false;
	}
	
	loadNews(0,5,"");
		
	$(window).scroll(function() {
		if($(window).scrollTop() + $(window).height() >= $(document).height()-50) {
			if (aff==0)
			{
				aff=1;
				loadNews(lastid,2,searchTxt);
			}
		}
	});
	

	function ClearText(e,txt) {
	
		if(window.event)
	          {
	          	//IE
	          	var t = window.event.srcElement;
	          } 
		else
	          { //firefox
	          	var t = e.target;
	          } 

		if (t.value==txt)
		  { t.value=''; t.style.color="#000000"; }
		return;
	}

	function CapturePost(e) {
		text="";
	
		if(window.event)
	          { key = window.event.keyCode;	} //IE
		else
	          { key = e.which;  } //firefox
	
		if (key==13)
		 { 
		 	<!-- document.forms["recherche"].submit();  -->
			return false;
	 	 }

		$("#news").text("");
		searchTxt=document.getElementById("search").value;
		loadNews(0,4,searchTxt);
	console.log(searchTxt);
	}

	
</script>

<!-- END: corps -->
